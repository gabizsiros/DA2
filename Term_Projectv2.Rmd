---
title: "Term Project"
author: "Zsiros, Gabriella"
date: "2022-12-11"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.pos = "H", out.extra = "")
```

```{r}
library(tidyverse)
library(modelsummary)
library(data.table)
```
https://databank.worldbank.org/source/food-prices-for-nutrition/preview/on
https://databank.worldbank.org/source/health-nutrition-and-population-statistics/preview/on
https://databank.worldbank.org/indicator/SP.DYN.LE00.IN/1ff4a498/Popular-Indicators
http://wdi.worldbank.org/table

## Introduction 
the first indicator i selected was the food price... (referred to as CoHD)
Based on numerous datasets on the worldbank eventually i chose to examine the life expetancy at birth in the respective countries, to attempt to discover a relationship betwen how expensive it is to nourish healthy and how "healthy" those people are. The latter is of course not an easy indicator to measure, and surely can be more refined, but as first step, the explanatory variable will be the Life expectancy at birth (referred to as LEaB later on)

## About the data:
worldbank, chosen variables

For the purpose of the analysis, the year 2020 is selected 
```{r}
#import
df <- read.csv('https://raw.githubusercontent.com/gabizsiros/DA2/main/worldbank_pop.csv')
df17 <- df %>% filter(Time == 2017)
food <- read.csv('foodprice.csv')
food <- food %>% filter(Time == 2017)

food <- select(food, -c(Time.Code,Time))
food$price <- as.numeric(food$Cost.of.a.healthy.diet..CoHD.)
food$Time <- as.character(food$Time)
df17 <- left_join(df17,food)

```

The core dataframe consist of the joining of the two tables, Food prices and Health. Table with smaller number of observations is kept as the base table. The main reason of the difference in `n` (number of observations) is that one of the data sources contained aggregated areas of countries, such as "Arab world" or "Euro Area".
During the data cleaning the two analyzed columns were renamed for easier processing:
* `"Cost.of.a.healthy.diet..CoHD."` as `CoHD`
* `"Life.expectancy.at.birth..total..years...SP.DYN.LE00.IN."` as `LEaB`

```{r}
#rename important columns
df17 <- df17 %>%  rename("GDPPC" = GDP.per.capita..constant.2015.US....NY.GDP.PCAP.KD.,
                     "GDPPPP" = GDP.per.capita..PPP..constant.2017.international.....NY.GDP.PCAP.PP.KD.,
                     "Migration" = Net.migration..SM.POP.NETM.,
                     "LEaB" = Life.expectancy.at.birth..total..years...SP.DYN.LE00.IN.,,
                     "Population" = Population..total..SP.POP.TOTL.,
                     "HCI" = Human.capital.index..HCI...scale.0.1...HD.HCI.OVRL.)


```



```{r}
#converting to number
df17$Migration <- as.numeric(df17$Migration)
df17$Population <- as.numeric(df17$Population)
df17$GDPPC <- as.numeric(df17$GDPPC)
df17$GDPPPP <-  as.numeric(df17$GDPPPP)
df17$LEaB <- as.numeric(df17$LEaB)
df17$HCI <- as.numeric(df17$HCI)

#dropping unnecessary columns
df17 <- select(df17, -Time.Code) 

#removing missing values
df17 <- na.omit(df17, Migration,GDPPC,GDPPPP,LEaB)


head(df17,10)
```


### Check distribution


```{r}
datasummary_skim(df17)
```
CoHD present a lognormal  distribution with longer right tail, LEaB is a distirbution between 53.7 and 85.4 

Check  missing values

Factor income

Plot linear, lowess, quad?


```{r}

ggplot (df17, aes(GDPPC,Migration)) +
  geom_point() +
  geom_smooth(method = loess)

```
```{r}
ggplot (df17, aes(log(GDPPC),Migration/Population)) +
  geom_point() +
  geom_smooth(method = loess)
```
```{r}
ggplot (df17, aes(log(GDPPC),Migration/Population)) +
  stat_summary_bin()
```


```{r}
#creating factor to distinguish if a coutry is target or origin
df17$in_out <- as.factor(ifelse(df17$Migration >0,"In","Out"))
df17in <- df17 %>%  filter(in_out == "In")
df17out <- df17 %>%  filter(in_out == "Out")
```


```{r}
ggplot()+
  geom_point(data = df17in,aes(log(GDPPC),log(Migration)), color = 'green') +
  geom_point(data = df17out,aes(log(GDPPC),log(abs(Migration))),color = 'red') + 
  geom_smooth(data = df17in,aes(log(GDPPC),log(Migration)), color = 'green', method = 'lm') +
  geom_smooth(data = df17out,aes(log(GDPPC),log(abs(Migration))),color = 'red',method = 'lm')
             
```

```{r}
ggplot (df17, aes(log(GDPPC),Migration)) +
  geom_point() +
  geom_smooth(method = lm)
```
```{r}
ggplot (df17, aes(price/GDPPC,Migration/Population)) +
  geom_point() +
  geom_smooth(method = lm)
```

```{r}
ggplot (df17, aes(GDPPC,log(Migration))) +
  geom_point() +
  geom_smooth(method = lm)
```
model1 
```{r}
model1 <- lm(Migration ~ GDPPC,df17)
model2 <- lm(Migration ~log(GDPPC),df17)
model3 <- lm(Migration/Population ~log(GDPPC),df17)

modelsummary(list(model1,model2,model3))

```

Plot on income variables